<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>VBoard</title>
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css" />
    <link rel="stylesheet" href="bower_components/angular-ui-notification/dist/angular-ui-notification.min.css">
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/angular/angular.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.js"></script>
    <script src="bower_components/elasticsearch/elasticsearch.angular.min.js"></script>
    <script src="bower_components/THREEDC/THREEDC.min.js"></script>
    <script src="generator_ESQueries_JS/genES.js"></script>
    <script src="builder_DataStructure/builderESDS.js"></script>
    <script src="bower_components/angular-modal-service/dst/angular-modal-service.min.js"></script>
    <script src="bower_components/angular-ui-notification/dist/angular-ui-notification.min.js"></script>
    <!--script src="main.js"></script-->
  </head>
  <body>
    <div ng-controller="MainController">

      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">VBoard</a>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
              <li class="active"><a href="#">Visualize <span class="sr-only">(current)</span></a></li>
            </ul>
          </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
      </nav>

      <div class="col-md-3">
        <div class="row">
          <label class="control-label col-sm-2" for="indexesList">Index:</label>
          <div class="col-md-10">
            <select class="form-control" id="indexesList">
              <option ng-repeat="index in indexes" value="{{index.name}}">{{index.name}}</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div >
            <button type="button" class="col-sm-4 btn btn-success" ng-click="searchMappingFromIndex()">Show Mapping</button>
            <button type="button" class="col-sm-8 btn btn-info" ng-click="typeFromIndex()">Select chart</button>
          </div>
        </div>

        <!--div ng-show="showTypeForm">
        <hr>
          <div class="row">
            <label class="control-label col-sm-2" for="typesList">Type:</label>
            <div class="col-sm-10">
              <select class="form-control" id="typesList">
                <option ng-repeat="type in types" value="{{type}}">{{type}}</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div >
              <button type="button" class="col-sm-6 btn btn-info" ng-click="showMetricsBuckets()">Show Metrics and Buckets</button>
              <button type="button" class="col-sm-6 btn btn-danger" ng-click="showTypeForm = false">Hide Type form</button>
            </div>
          </div>
        </div-->

        <div ng-show="showTypeForm">
        <hr>
          <div class="row">
            <label class="control-label col-sm-2" for="typesList">VisType:</label>
            <div class="col-sm-10">
              <select class="form-control" ng-model="visType" id="typesList" ng-change="showMetricBucketsForm = false">
                <option value="pie">Pie</option>
                <option value="bars">Bars</option>
                <option value="line">Line</option>
                <option value="curve">Smooth curve</option>
                <option value="3DBars">3D Bars</option>
                <option value="bubbles">Bubbles</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div >
              <button type="button" class="col-sm-6 btn btn-info" ng-click="showMetricsBuckets()">Select Data</button>
              <button type="button" class="col-sm-6 btn btn-danger" ng-click="(showTypeForm = false) && (showMetricBucketsForm = false)">Cancel</button>
            </div>
          </div>
        </div>



        <div ng-show="showMetricBucketsForm && showTypeForm">
        <hr>
          <h3>Metrics:</h3>
          <div class="row">
            <label class="control-label col-md-2" for="metricList">Type:</label>
            <div class="col-md-10">
              <select class="form-control" ng-model="metricList" id="metricList" ng-change="showFieldsOfMetricType()">
                <option value="count">Count</option>
                <option value="avg">Average</option>
                <option value="sum">Sum</option>
                <option value="median">Median</option>
                <option value="max">Max</option>
                <option value="min">Min</option>
                <option value="extended_stats">Standard Deviation</option>
                <option value="cardinality">Unique Count</option>
              </select>
            </div>
            <div class="col-md-12" ng-show="metricList!='count'">
              <label class="control-label col-md-2" for="fieldMetricList">Field:</label>
              <div class="col-md-10">
                <select class="form-control" id="fieldMetricList">
                  <option ng-repeat="fieldMetric in fieldsMetric" value="{{fieldMetric}}">{{fieldMetric}}</option>
                </select>
              </div>
            </div>
          </div>
          <button type="button" class="col-sm-12 btn btn-success" ng-click="addMetricForm()" ng-show="showAddMetricVisType()">Add Metric</button>
          <br>
          <h3>Buckets:</h3>
          <div class="row">
            <label class="control-label col-md-2" for="aggregationBucketList">Type:</label>
            <div class="col-md-4">
              <select ng-model="typeBucket" class="form-control" id="aggregationBucketList" ng-change="showFieldsOfTypeAggregation()">
                <option value="terms">Terms</option>
                <option value="date_histogram">Date Histogram</option>
                <option value="histogram">Histogram</option>
                <option value="one">One</option>
              </select>
            </div>
            <label class="control-label col-md-2" for="fieldBucketsList">Field:</label>
            <div class="col-md-4">
              <select class="form-control" id="fieldBucketsList">
                <option ng-repeat="field in fields" value="{{field}}">{{field}}</option>
              </select>
            </div>
          </div>
          <div class="row" ng-show="typeBucket=='terms'">
            <label class="control-label col-md-2" for="bucketsList">Size:</label>
            <div class="col-md-10">
              <input type="number" class="form-control" id="sizeValue" value="5">
            </div>
          </div>
          <div class="row" ng-show="typeBucket=='date_histogram'">
            <label class="control-label col-md-2" for="intervalDateHistogram">Interval:</label>
            <div class="col-md-10">
              <select class="form-control" id="intervalDateHistogram">
                <option value="1d">Daily</option>
                <option value="1w">Weekly</option>
                <option value="1M">Monthly</option>
                <option value="1y">Yearly</option>
              </select>
            </div>
          </div>
          <div class="row" ng-show="typeBucket=='histogram'">
            <label class="control-label col-md-2" for="intervalHistogram">Interval:</label>
            <div class="col-md-10">
              <input type="number" class="form-control" id="intervalHistogram" value="7000">
            </div>
          </div>
          <button type="button" class="col-sm-12 btn btn-success" ng-click="addSubbucketForm()" ng-show="showAddSubBucketVisType()">Add Sub_Bucket</button>
          <div class="row">
            <div >
              <button type="button" class="col-md-6 btn btn-info" ng-click="showData()">Play</button>
              <button type="button" class="col-md-6 btn btn-danger" ng-click="hideMetricsBucketsForm()">Cancel</button>
            </div>
          </div>

          <br>
          <div class="row">
            <div >
              <button type="button" class="col-md-12 btn btn-success" ng-click="showHitsAggregations = !showHitsAggregations">Show response (JSON)</button>
            </div>
          </div>
          <h3>Selected:</h3>
          <hr>
          {{metricsSelected}}

          <div ng-repeat="ms in metricsSelected" class="panel-group">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                  <a data-toggle="collapse" href="#collapse{{ $index + 1 }}" ng-click="reopenFormToChangeAgg($index, bs, 'metric')">({{ms.id}}) {{ms.type}}: {{ms.aggregationType}} - {{ms.aggregationField}}</a>
                </h4>
              </div>
              <div id="collapse{{ $index + 1 }}" class="panel-collapse collapse">
                <div class="panel-body">Panel Body</div>
              </div>
            </div>
          </div>

          <hr>
          {{bucketsSelected}}

          <div ng-repeat="bs in bucketsSelected" class="panel-group">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                  <a data-toggle="collapse" href="#collapse{{ $index + 10 }}" ng-click="reopenFormToChangeAgg($index+10, bs, 'bucket')">({{bs.id}}) {{bs.type}}: {{bs.aggregationType}} - {{bs.aggregationField}}</a>
                </h4>
              </div>
              <div id="collapse{{ $index + 10 }}" class="panel-collapse collapse">

              </div>
            </div>
          </div>
        </div>

        <hr>
        <div class="row">
          <button type="button" class="col-md-12 btn btn-info" ng-click="openSaveModal()">Save visualization</button>
          <button type="button" class="col-md-12 btn btn-success" ng-click="openLoadModal()">Load visualization</button>
        </div>
      </div>

      <div class="col-md-9" id="ThreeJS" class="row" style="height:60px; left:0px; top:0px"></div>

      <div class="row" ng-show="showHitsAggregations">
        <div class="col-md-12">
          <div class="col-md-6">
            <h2>Hits:</h2>
            <pre>{{hits}}</pre>
          </div>
          <div class="col-md-6">
            <h2>Aggregations:</h2>
            <pre>{{aggregationsToShow}}</pre>
          </div>
        </div>
      </div>

      <div class="row" ng-show="showMapping">
        <div class="col-md-12">
          <h2>Mapping of {{indexName}}:</h2>
          <pre>{{mapping}}</pre>
        </div>
      </div>

    </div>

    <script type="text/ng-template" id="modal.html">
      <div class="modal fade">
        <div class="modal-dialog modal-lg">
         <div class="modal-content">
           <div class="modal-header">
             <button type="button" class="close" ng-click="close()" data-dismiss="modal" aria-hidden="true">&times;</button>
             <h4 class="modal-title">Save visualization</h4>
           </div>
           <div class="modal-body">

         <form class="form-horizontal" role="form">
           <div class="form-group">
             <label for="name" class="col-sm-2 control-label">Name</label>
             <div class="col-sm-10">
               <input type="text" class="form-control" ng-model="name" id="name" placeholder="Visualization Name" ng-model="name">
             </div>
           </div>
           <div class="form-group">
             <label for="age" class="col-sm-2 control-label">Description</label>
             <div class="col-sm-10">
               <input type="text" class="form-control" ng-model="description" id="description" placeholder="Description" ng-model="name">
             </div>
           </div>
         </form>

           </div>
           <div class="modal-footer">
             <button type="button" ng-click="save()" class="btn btn-primary" data-dismiss="modal">Save!</button>
             <button type="button" ng-click="cancel()" class="btn" data-dismiss="modal">Cancel</button>
           </div>
         </div>
        </div>
      </div>
     </script>

     <script type="text/ng-template" id="loadmodal.html">
       <div class="modal fade">
         <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" ng-click="close()" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title">Choose visualization</h4>
            </div>
            <div class="modal-body">
              <ul class="list-group">
                <a href="#" data-dismiss="modal" ng-click="loadVis(vis._source.visobject)" class="list-group-item" ng-repeat="vis in loadedvis"><span class="badge">{{vis._source.chartType}}</span>
                  <h4 class="list-group-item-heading">{{vis._source.name}}</h4>
                  <p class="list-group-item-text">{{vis._source.description}}</p>
                </a>
              </ul>
            </div>
            <div class="modal-footer">
              <button type="button" ng-click="cancel()" class="btn" data-dismiss="modal">Cancel</button>
            </div>
          </div>
         </div>
       </div>
      </script>

      <script type="text/ng-template" id="modalconfirm.html">
        <div class="modal fade">
          <div class="modal-dialog modal-lg">
           <div class="modal-content">
             <div class="modal-header">
               <button type="button" class="close" ng-click="close()" data-dismiss="modal" aria-hidden="true">&times;</button>
               <h4 class="modal-title">A visualization with this name is already saved. Are you sure to overwrite it?</h4>
             </div>
             <div class="modal-body text-center" >
               <button type="button" ng-click="confirmUpdate()" class="btn btn-primary" data-dismiss="modal">Yes</button>
               <button type="button" ng-click="cancelUpdate()" class="btn" data-dismiss="modal">No</button>
             </div>
           </div>
          </div>
        </div>
       </script>
  <script data-main="main" src="bower_components/requirejs/require.js"></script>
  </body>
</html>
